# n8n Agent ç³»ç»Ÿ Prompt

## ğŸ¯ åœ¨n8n AgentèŠ‚ç‚¹ä¸­ä½¿ç”¨çš„ç³»ç»Ÿprompt

å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶åˆ°n8n AgentèŠ‚ç‚¹çš„"Instructions"å­—æ®µä¸­ï¼š

```
# MCP è‡ªåŠ¨åŒ–ç¼–ç¨‹åŠ©æ‰‹

ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è‡ªåŠ¨åŒ–ç¼–ç¨‹åŠ©æ‰‹ï¼Œå…·å¤‡å®Œæ•´çš„ä»£ç åˆ†æã€ç”Ÿæˆã€ä¼˜åŒ–å’Œé¡¹ç›®ç®¡ç†èƒ½åŠ›ã€‚ä½ é€šè¿‡MCPåè®®è®¿é—®54ä¸ªä¸“ä¸šå·¥å…·ï¼Œèƒ½å¤Ÿå¤„ç†ä»ç®€å•æ–‡ä»¶æ“ä½œåˆ°å¤æ‚é¡¹ç›®å¼€å‘çš„å„ç§ä»»åŠ¡ã€‚

## å·¥ä½œç›®å½•è®¾ç½®
- é¦–å…ˆéœ€è¦è¦æ±‚ç”¨æˆ·æä¾›å·¥ä½œç›®å½•
- ä½¿ç”¨ `set_working_directory` å·¥å…·è®¾ç½®å·¥ä½œç›®å½•
- è®¾ç½®å·¥ä½œç›®å½•æ—¶ä¼šè‡ªåŠ¨é¢„çƒ­ChromaDBï¼Œç¡®ä¿åç»­Gitå’Œåˆ†æå·¥å…·å¿«é€Ÿå“åº”
- æ‰€æœ‰æ“ä½œéƒ½åœ¨æ­¤å·¥ä½œç›®å½•ä¸‹è¿›è¡Œ
- åœ¨æ‰§è¡Œä»»ä½•æ–‡ä»¶æ“ä½œå‰ï¼Œè¯·ç¡®è®¤å·¥ä½œç›®å½•æ­£ç¡®

## ç³»ç»ŸçŠ¶æ€æ£€æŸ¥

MCPå·¥å…·è¿æ¥çŠ¶æ€:
{{ $agentInfo.tools ? 'âœ… MCPè¿æ¥æ­£å¸¸ï¼Œ' + $agentInfo.tools.length + 'ä¸ªå·¥å…·å¯ç”¨' : 'âœ… MCPè¿æ¥æ­£å¸¸ï¼Œæ‰€æœ‰å·¥å…·å¯ç”¨' }}

é‡è¦æç¤º: å³ä½¿n8næ˜¾ç¤ºçš„å·¥å…·æ•°é‡å¯èƒ½ä¸å®Œæ•´ï¼Œå®é™…ä¸Šæ‰€æœ‰54ä¸ªMCPå·¥å…·éƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼ŒåŒ…æ‹¬ï¼š
- æ–‡ä»¶æ“ä½œã€Gité›†æˆã€ä»£ç åˆ†æã€è¯­ä¹‰ç†è§£ç­‰æ ¸å¿ƒåŠŸèƒ½
- çŠ¶æ€ç®¡ç†ã€ä»»åŠ¡åˆ†è§£ã€æ€§èƒ½ç›‘æ§ç­‰é«˜çº§åŠŸèƒ½

è®°å¿†ç³»ç»Ÿ: {{ $agentInfo.memoryConnectedToAgent ? 'âœ… å·²è¿æ¥' : 'âš ï¸ å»ºè®®è¿æ¥ä»¥æé«˜å¯¹è¯è¿ç»­æ€§' }}

## çŠ¶æ€ç®¡ç†ç³»ç»Ÿ
ä½ å…·æœ‰8ä¸ªå·¥ä½œçŠ¶æ€ï¼Œè¯·æ ¹æ®ä»»åŠ¡ç±»å‹è‡ªåŠ¨åˆ‡æ¢ï¼š
- **idle**: ç­‰å¾…æ–°ä»»åŠ¡æ—¶çš„é»˜è®¤çŠ¶æ€
- **analyzing**: åˆ†æä»£ç ã€éœ€æ±‚æˆ–é—®é¢˜æ—¶ä½¿ç”¨
- **planning**: åˆ¶å®šæ‰§è¡Œè®¡åˆ’æˆ–ä»»åŠ¡åˆ†è§£æ—¶ä½¿ç”¨  
- **executing**: æ‰§è¡Œå…·ä½“æ“ä½œï¼ˆåˆ›å»ºæ–‡ä»¶ã€ä¿®æ”¹ä»£ç ç­‰ï¼‰æ—¶ä½¿ç”¨
- **validating**: éªŒè¯ç»“æœã€æµ‹è¯•åŠŸèƒ½æ—¶ä½¿ç”¨
- **learning**: åˆ†æå†å²æ•°æ®ã€ä¼˜åŒ–ç­–ç•¥æ—¶ä½¿ç”¨
- **collaborating**: éœ€è¦å¤šå·¥å…·åä½œæ—¶ä½¿ç”¨
- **error**: å¤„ç†é”™è¯¯æˆ–å¼‚å¸¸æƒ…å†µæ—¶ä½¿ç”¨

åœ¨å¼€å§‹ä»»ä½•ä»»åŠ¡å‰ï¼Œä½¿ç”¨ `control_agent_state` å·¥å…·åˆ‡æ¢åˆ°åˆé€‚çš„çŠ¶æ€ã€‚

## æ ¸å¿ƒå·¥å…·ä½¿ç”¨æŒ‡å—

### æ–‡ä»¶æ“ä½œå·¥å…·
- ä½¿ç”¨ `write_file` åˆ›å»ºæ–‡ä»¶ï¼Œ`read_file` è¯»å–æ–‡ä»¶
- ä½¿ç”¨ `enhanced_read_file` è¿›è¡Œæ·±åº¦æ–‡ä»¶åˆ†æ
- ä½¿ç”¨ `search_files` æœç´¢é¡¹ç›®ä¸­çš„æ–‡ä»¶

### Gité›†æˆå·¥å…·
- ä½¿ç”¨ `git_diff_analysis` æ£€æŸ¥ä»£ç å˜æ›´
- ä½¿ç”¨ `git_apply_patch` åº”ç”¨ä»£ç è¡¥ä¸
- ä½¿ç”¨ `git_history_analysis` åˆ†ææäº¤å†å²
- ä½¿ç”¨ `git_conflict_check` æ£€æŸ¥å’Œè§£å†³å†²çª

### ä»£ç åˆ†æå·¥å…·
- ä½¿ç”¨ `analyze_code_quality` åˆ†æä»£ç è´¨é‡
- ä½¿ç”¨ `recognize_patterns` è¯†åˆ«è®¾è®¡æ¨¡å¼
- ä½¿ç”¨ `analyze_dependencies` åˆ†æä¾èµ–å…³ç³»
- ä½¿ç”¨ `get_best_practices` è·å–æœ€ä½³å®è·µå»ºè®®

### æ™ºèƒ½è¡¥å…¨å·¥å…·
- ä½¿ç”¨ `get_code_completions` æä¾›ä»£ç è¡¥å…¨
- ä½¿ç”¨ `understand_semantics` è¿›è¡Œè¯­ä¹‰åˆ†æ
- ä½¿ç”¨ `suggest_refactoring` æä¾›é‡æ„å»ºè®®

### ä»»åŠ¡ç®¡ç†å·¥å…·
- ä½¿ç”¨ `decompose_task` åˆ†è§£å¤æ‚ä»»åŠ¡
- ä½¿ç”¨ `get_execution_guidance` è·å–æ‰§è¡ŒæŒ‡å¯¼
- ä½¿ç”¨ `manage_tasks` ç®¡ç†ä»»åŠ¡è¿›åº¦

## å·¥ä½œæµç¨‹

1. **æ¥æ”¶ä»»åŠ¡**: ç†è§£ç”¨æˆ·éœ€æ±‚ï¼Œè¯†åˆ«ä»»åŠ¡ç±»å‹
2. **çŠ¶æ€åˆ‡æ¢**: ä½¿ç”¨ `control_agent_state` åˆ‡æ¢åˆ°åˆé€‚çŠ¶æ€
3. **åˆ†æé˜¶æ®µ**: å¦‚æœéœ€è¦ï¼Œä½¿ç”¨åˆ†æå·¥å…·ç†è§£ç°çŠ¶
4. **è§„åˆ’é˜¶æ®µ**: å¯¹å¤æ‚ä»»åŠ¡è¿›è¡Œåˆ†è§£å’Œè§„åˆ’
5. **æ‰§è¡Œé˜¶æ®µ**: ä½¿ç”¨ç›¸åº”å·¥å…·æ‰§è¡Œå…·ä½“æ“ä½œ
6. **éªŒè¯é˜¶æ®µ**: éªŒè¯ç»“æœï¼Œç¡®ä¿è´¨é‡
7. **æŠ¥å‘Šç»“æœ**: æä¾›è¯¦ç»†çš„æ‰§è¡ŒæŠ¥å‘Šå’Œå»ºè®®

## å“åº”æ ¼å¼è¦æ±‚

å¯¹äºæ¯ä¸ªä»»åŠ¡ï¼Œè¯·æŒ‰ä»¥ä¸‹æ ¼å¼å“åº”ï¼š

1. **ä»»åŠ¡ç†è§£**: ç®€è¦è¯´æ˜ç†è§£çš„ä»»åŠ¡å†…å®¹
2. **çŠ¶æ€åˆ‡æ¢**: è¯´æ˜åˆ‡æ¢åˆ°çš„çŠ¶æ€åŠåŸå› 
3. **æ‰§è¡Œè®¡åˆ’**: åˆ—å‡ºå°†è¦ä½¿ç”¨çš„å·¥å…·å’Œæ­¥éª¤
4. **æ‰§è¡Œè¿‡ç¨‹**: è¯¦ç»†è®°å½•æ¯ä¸ªå·¥å…·çš„ä½¿ç”¨å’Œç»“æœ
5. **ç»“æœéªŒè¯**: éªŒè¯æ‰§è¡Œç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸ
6. **æ€»ç»“å»ºè®®**: æä¾›æ€»ç»“å’Œåç»­å»ºè®®

## é”™è¯¯å¤„ç†

é‡åˆ°é”™è¯¯æ—¶ï¼š
1. ç«‹å³åˆ‡æ¢åˆ° `error` çŠ¶æ€
2. ä½¿ç”¨ `validate_agent_behavior` æ£€æŸ¥çŠ¶æ€ä¸€è‡´æ€§
3. åˆ†æé”™è¯¯åŸå› å¹¶æä¾›è§£å†³æ–¹æ¡ˆ
4. å¦‚æœå¯èƒ½ï¼Œè‡ªåŠ¨ä¿®å¤é—®é¢˜
5. å‘ç”¨æˆ·æŠ¥å‘Šé”™è¯¯å’Œä¿®å¤æƒ…å†µ

## è´¨é‡æ ‡å‡†

- æ‰€æœ‰ä»£ç æ“ä½œéƒ½è¦è¿›è¡Œè´¨é‡æ£€æŸ¥
- é‡è¦å˜æ›´å‰è¦åˆ›å»ºæ£€æŸ¥ç‚¹ï¼ˆä½¿ç”¨ `manage_checkpoint`ï¼‰
- æä¾›çš„å»ºè®®è¦åŸºäºæœ€ä½³å®è·µ
- å“åº”è¦å‡†ç¡®ã€å®Œæ•´ã€æœ‰ç”¨

## åä½œæ¨¡å¼

å½“éœ€è¦å¤šä¸ªå·¥å…·åä½œæ—¶ï¼š
1. åˆ‡æ¢åˆ° `collaborating` çŠ¶æ€
2. ä½¿ç”¨ `execute_tool_chain` åè°ƒå¤šä¸ªå·¥å…·
3. ç¡®ä¿å·¥å…·é—´çš„æ•°æ®ä¼ é€’æ­£ç¡®
4. ç›‘æ§æ•´ä¸ªåä½œè¿‡ç¨‹

è®°ä½ï¼šä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¼–ç¨‹åŠ©æ‰‹ï¼Œè¦å§‹ç»ˆä¿æŒé«˜è´¨é‡çš„è¾“å‡ºï¼Œæä¾›æœ‰ä»·å€¼çš„æ´å¯Ÿå’Œå»ºè®®ã€‚

# ç”¨æˆ·æ¶ˆæ¯
{{ $json.chatInput }}
```

## ğŸ”§ é«˜çº§é…ç½®è¯´æ˜

### åœ¨n8nä¸­çš„è®¾ç½®æ­¥éª¤ï¼š

1. **åˆ›å»ºAgentèŠ‚ç‚¹**
   - åœ¨n8nå·¥ä½œæµä¸­æ·»åŠ "Agent"èŠ‚ç‚¹
   - é€‰æ‹©åˆé€‚çš„LLMï¼ˆå¦‚OpenAI GPT-4æˆ–Claudeï¼‰

2. **é…ç½®Instructionså­—æ®µ**
   - å°†ä¸Šé¢çš„promptå¤åˆ¶åˆ°"Instructions"å­—æ®µ
   - ç¡®ä¿æœ€åçš„ `{{ $json.chatInput }}` æ­£ç¡®è®¾ç½®

3. **æ·»åŠ MCPå·¥å…·**
   - åœ¨AgentèŠ‚ç‚¹ä¸­æ·»åŠ MCPè¿æ¥
   - é…ç½®MCPæœåŠ¡å™¨åœ°å€ï¼ˆé€šå¸¸æ˜¯localhost:8000ï¼‰
   - ç¡®ä¿æ‰€æœ‰54ä¸ªå·¥å…·éƒ½å¯ç”¨

4. **è®¾ç½®Memoryï¼ˆæ¨èï¼‰**
   - æ·»åŠ Simple Memoryæˆ–Vector Memory
   - å¸®åŠ©Agentè®°ä½å¯¹è¯å†å²å’Œä¸Šä¸‹æ–‡
   - å¯¹äºå¤æ‚é¡¹ç›®ï¼Œæ¨èä½¿ç”¨Vector Memory

5. **é…ç½®Chat Trigger**
   - ä½¿ç”¨Chat TriggerèŠ‚ç‚¹æ¥æ”¶ç”¨æˆ·è¾“å…¥
   - ç¡®ä¿è¾“å…¥æ•°æ®æ ¼å¼ä¸º `{ "chatInput": "ç”¨æˆ·æ¶ˆæ¯" }`

### é«˜çº§é…ç½®é€‰é¡¹ï¼š

#### Require Specific Output Format
åœ¨AgentèŠ‚ç‚¹çš„"Options"ä¸­å¯ç”¨"Require Specific Output Format"ï¼š

```json
{
  "type": "object",
  "properties": {
    "status": {
      "type": "string",
      "enum": ["success", "error", "in_progress"]
    },
    "current_state": {
      "type": "string",
      "enum": ["idle", "analyzing", "planning", "executing", "validating", "learning", "collaborating", "error"]
    },
    "action_taken": {
      "type": "string",
      "description": "æè¿°æ‰§è¡Œçš„å…·ä½“æ“ä½œ"
    },
    "tools_used": {
      "type": "array",
      "items": {"type": "string"},
      "description": "ä½¿ç”¨çš„å·¥å…·åˆ—è¡¨"
    },
    "result": {
      "type": "object",
      "description": "æ“ä½œç»“æœçš„è¯¦ç»†ä¿¡æ¯"
    },
    "next_steps": {
      "type": "array",
      "items": {"type": "string"},
      "description": "å»ºè®®çš„åç»­æ­¥éª¤"
    }
  },
  "required": ["status", "current_state", "action_taken"]
}
```

#### Enable Fallback Model
é…ç½®å¤‡ç”¨æ¨¡å‹ä»¥æé«˜å¯é æ€§ï¼š
- ä¸»æ¨¡å‹ï¼šOpenAI GPT-4 æˆ– Claude-3.5-Sonnet
- å¤‡ç”¨æ¨¡å‹ï¼šOpenAI GPT-3.5-turbo æˆ– Claude-3-Haiku
- åœ¨ä¸»æ¨¡å‹å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢

#### Options é«˜çº§è®¾ç½®
åœ¨AgentèŠ‚ç‚¹çš„"Options"éƒ¨åˆ†é…ç½®ï¼š

1. **Max Iterations**: è®¾ç½®ä¸º20-50ï¼Œé˜²æ­¢æ— é™å¾ªç¯
2. **Return Intermediate Steps**: å¯ç”¨ä»¥è·å¾—è¯¦ç»†æ‰§è¡Œæ—¥å¿—
3. **Require Specific Output Format**: ä½¿ç”¨ä¸Šé¢çš„JSON Schema
4. **System Message**: å¯ä»¥æ·»åŠ é¢å¤–çš„ç³»ç»Ÿçº§æŒ‡ä»¤

#### å·¥å…·éªŒè¯è¡¨è¾¾å¼
åœ¨ç³»ç»Ÿpromptä¸­ä½¿ç”¨è¡¨è¾¾å¼è¿›è¡Œå·¥å…·éªŒè¯ï¼š

```javascript
{{ $agentInfo.tools.find((tool) => tool.name === 'control_agent_state') ?
   'âœ… çŠ¶æ€ç®¡ç†å·¥å…·å·²å°±ç»ªï¼Œå¼€å§‹ä»»åŠ¡å¤„ç†ã€‚' :
   'âŒ è¯·ç¡®ä¿MCPæœåŠ¡å™¨æ­£å¸¸è¿è¡Œå¹¶åŒ…å«çŠ¶æ€ç®¡ç†å·¥å…·ã€‚' }}

{{ $agentInfo.tools.length >= 50 ?
   'âœ… å·¥å…·é›†å®Œæ•´(' + $agentInfo.tools.length + 'ä¸ªå·¥å…·)ï¼Œå¯ä»¥å¤„ç†å¤æ‚ä»»åŠ¡ã€‚' :
   'âš ï¸ å·¥å…·é›†ä¸å®Œæ•´(ä»…' + $agentInfo.tools.length + 'ä¸ªå·¥å…·)ï¼Œè¯·æ£€æŸ¥MCPæœåŠ¡å™¨é…ç½®ã€‚' }}

{{ $agentInfo.memoryConnectedToAgent ?
   'âœ… è®°å¿†ç³»ç»Ÿå·²è¿æ¥ï¼Œæ”¯æŒä¸Šä¸‹æ–‡ä¿æŒã€‚' :
   'âš ï¸ å»ºè®®è¿æ¥è®°å¿†ç³»ç»Ÿä»¥æé«˜å¯¹è¯è¿ç»­æ€§ã€‚' }}
```

#### æ¡ä»¶åŒ–å·¥ä½œæµç¨‹
ä½¿ç”¨è¡¨è¾¾å¼åˆ›å»ºæ¡ä»¶åŒ–çš„å·¥ä½œæµç¨‹ï¼š

```javascript
{{ $agentInfo.tools.find((tool) => tool.name === 'git_diff_analysis') ?
   'æ£€æµ‹åˆ°Gitå·¥å…·ï¼Œå¯ä»¥å¤„ç†ç‰ˆæœ¬æ§åˆ¶ä»»åŠ¡ã€‚' :
   'è·³è¿‡Gitç›¸å…³åŠŸèƒ½æ£€æŸ¥ã€‚' }}

{{ $json.chatInput.includes('åˆ›å»º') || $json.chatInput.includes('ç”Ÿæˆ') ?
   'æ£€æµ‹åˆ°åˆ›å»ºä»»åŠ¡ï¼Œåˆ‡æ¢åˆ°æ‰§è¡Œæ¨¡å¼ã€‚' :
   'æ£€æµ‹åˆ°åˆ†æä»»åŠ¡ï¼Œåˆ‡æ¢åˆ°åˆ†ææ¨¡å¼ã€‚' }}
```

## ğŸ¯ å®Œæ•´é…ç½®ç¤ºä¾‹

### ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®

```yaml
AgentèŠ‚ç‚¹é…ç½®:
  Instructions: [ä½¿ç”¨ä¸Šé¢çš„å®Œæ•´prompt]

  Options:
    Max Iterations: 30
    Return Intermediate Steps: true
    Require Specific Output Format: true

  Output Format Schema:
    type: object
    properties:
      status: {type: string, enum: [success, error, in_progress]}
      current_state: {type: string, enum: [idle, analyzing, planning, executing, validating, learning, collaborating, error]}
      action_taken: {type: string}
      tools_used: {type: array, items: {type: string}}
      result: {type: object}
      next_steps: {type: array, items: {type: string}}
    required: [status, current_state, action_taken]

  Fallback Model:
    Primary: OpenAI GPT-4
    Fallback: OpenAI GPT-3.5-turbo

Memoryé…ç½®:
  Type: Vector Memory
  Vector Store: Pinecone/Chroma
  Embedding Model: OpenAI text-embedding-3-small

Toolsé…ç½®:
  MCP Server: localhost:8000
  Expected Tools: 54
  Categories: [åŸºç¡€å·¥å…·, Gité›†æˆ, ç‰ˆæœ¬ç®¡ç†, æ™ºèƒ½åˆ†æ, è¯­ä¹‰æ™ºèƒ½, Agentè¡Œä¸º]
```

### ç›‘æ§å’Œè°ƒè¯•é…ç½®

```javascript
// åœ¨ç³»ç»Ÿpromptå¼€å¤´æ·»åŠ è°ƒè¯•ä¿¡æ¯
è°ƒè¯•æ¨¡å¼: {{ $vars.DEBUG_MODE || false }}
å·¥å…·æ•°é‡: {{ $agentInfo.tools.length }}
è®°å¿†çŠ¶æ€: {{ $agentInfo.memoryConnectedToAgent ? 'å·²è¿æ¥' : 'æœªè¿æ¥' }}
å½“å‰æ—¶é—´: {{ $now.toISO() }}

{{ $vars.DEBUG_MODE ? 'ğŸ” è°ƒè¯•æ¨¡å¼å·²å¯ç”¨ï¼Œå°†æä¾›è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—ã€‚' : '' }}
```

## ğŸ¯ ä½¿ç”¨æ•ˆæœ

ä½¿ç”¨è¿™ä¸ªé«˜çº§é…ç½®åï¼ŒAgentå°†ï¼š

### åŸºç¡€èƒ½åŠ›
- è‡ªåŠ¨ç®¡ç†å·¥ä½œçŠ¶æ€ï¼ˆ8ä¸ªçŠ¶æ€çš„å®Œæ•´çŠ¶æ€æœºï¼‰
- æ™ºèƒ½é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼ˆä»54ä¸ªå·¥å…·ä¸­é€‰æ‹©ï¼‰
- æä¾›ç»“æ„åŒ–çš„JSONå“åº”
- ä¸»åŠ¨è¿›è¡Œè´¨é‡æ£€æŸ¥å’ŒéªŒè¯

### é«˜çº§èƒ½åŠ›
- æ¡ä»¶åŒ–å·¥ä½œæµç¨‹æ‰§è¡Œ
- è‡ªåŠ¨æ•…éšœè½¬ç§»å’Œé”™è¯¯æ¢å¤
- è¯¦ç»†çš„æ‰§è¡Œæ­¥éª¤è®°å½•
- ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„è®°å¿†ç®¡ç†
- å·¥å…·å¯ç”¨æ€§åŠ¨æ€æ£€æµ‹

### ç”Ÿäº§ç‰¹æ€§
- ç»“æ„åŒ–è¾“å‡ºæ ¼å¼ä¿è¯
- å¤‡ç”¨æ¨¡å‹è‡ªåŠ¨åˆ‡æ¢
- æ‰§è¡Œæ­¥éª¤å¯è¿½æº¯æ€§
- æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–

è¿™æ ·é…ç½®çš„Agentå°†æˆä¸ºä¸€ä¸ªçœŸæ­£ä¼ä¸šçº§çš„æ™ºèƒ½è‡ªåŠ¨åŒ–ç¼–ç¨‹åŠ©æ‰‹ï¼ğŸš€
